<!DOCTYPE html>
<html>
    <script>
        window.GAME_ID = "{{ GAME_ID }}";
    </script>
    <script>
        // https://stackoverflow.com/questions/1349404/generate-a-string-of-random-characters
        function makeid(length) {
            var result           = '';
            var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            var charactersLength = characters.length;
            for ( var i = 0; i < length; i++ ) {
                result += characters.charAt(Math.floor(Math.random() * charactersLength));
            }
            return result;
        }

        const ws = new WebSocket(`ws://${document.location.host}/ws`);

        ws.onmessage = ev => {
            console.log(JSON.parse(ev.data));
        };

        ws.onopen = ev => {
            ws.send(JSON.stringify({
                packet_type: 'player_register',
                game_id: window.GAME_ID,
                username: makeid(12)
            }));
        };

        ws.onclose = console.log;
        ws.onerror = console.error;
    </script>
</html>